# poiskovik
Search system

## Готовые базы данных можно скачать по ссылке: 

Единая большая БД:
* БД с файлами из папок с AA по AZ: https://drive.google.com/file/d/18QCuaEubIC7oLUfkgSWWFH4netJelP3K/view?usp=sharing 742414 элемента

Эти БД размещаются в папке source/text_parser/data/data_bases/monolit/

Несколько маленьких БД, в которых хранятся те же документы:
* БД с фалами из папок AA, AB, AD: https://drive.google.com/file/d/1PnDPgDIhrbA5MMcR4maIKYG5cIDzTcSE/view?usp=sharing 744954 элемента
* БД с фалами из папок AC, AE, AF: https://drive.google.com/file/d/1IzvYGFhlzuVd9bmEsrGRA2mIWIzHuvBV/view?usp=sharing 80782 элемента
* БД с фалами из папок AG, AH, AI: https://drive.google.com/file/d/14X2v96_u3ytjwGaje3RUhQX3aMT8LaX8/view?usp=sharing 101628 элемента
* БД с фалами из папок AJ, AK, AL: https://drive.google.com/file/d/1NUBi3YrZRzgdcOX4tBpX5z1tG-tLH7OL/view?usp=sharing 98488 элемента
* БД с фалами из папок AM, AN, AO: https://drive.google.com/file/d/1LwfmhxRBfqf-YDg6kilqHaJMkIYChavY/view?usp=sharing 98653 элемента
* БД с фалами из папок AP, AQ, AR: https://drive.google.com/file/d/1x3kMJbmmqHImcRwZJz-JvswhpTvKzyf8/view?usp=sharing 95519 элемента
* БД с фалами из папок AS, AT, AU: https://drive.google.com/file/d/10gStaAhQWz3h0HM_AFlYHXsEuIi3zWXu/view?usp=sharing 83965 элемента
* БД с фалами из папок AW, AV, AX: https://drive.google.com/file/d/1sHd6nMWp-919gNwuXTpwrN2SjdL1yaLl/view?usp=sharing 45838 элемента
* БД с фалами из папок AY, AZ: https://drive.google.com/file/d/188V9v1-DWiSH6fR01e5bRWkDkTFC27jP/view?usp=sharing 62592 элемента

Эти БД размещаются в папке source/text_parser/data/data_bases/sharded/

К названию каждой БД нужно добавить приписку например "text_parser/data/data_bases/sharded/vectorDB_0.index" с порядковым номером архива. 

Под базами данных имеются ввиду две БД: векторная БД, БД с метаданными.
Базы данных хранят документы из википедии, а конкретнее, документы разбиваются на блоки в соответствии с оглавлением документов.
Каждый блок хранится в виде вектрора в вектрной БД и в виде метаданных во второй БД.


### Векторная БД - vectorDB.index
- Вектор блока текста
- Индекс вектора

#### Принципы выбора индекса
https://github.com/facebookresearch/faiss/wiki/Guidelines-to-choose-an-index

### БД с метаданными 

#### SQL БД - documentsMetadataDB.db
- index
- url
- title
- proc_article
- stem_article
- article

*Порядок записей в вектроной БД и БД с метаданными синхронизирован*

## Тестовый скрипт (test_models.py)

В папке data/queries_split лежат статьи из википедии, разбитые на абзацы, к каждому из которых придуман вопрос. Тестовая система берёт один такой файл, запускает поисковик на каждом из вопросов, а затем измеряет, как быстро были получены результаты и на каком месте был "правильный" абзац.

Запуск: python3 test_models.py test_configs.txt
Скрипт перебирает все возможные конфигурации из файла test_configs.txt и выводит оценку, среднее время и стандартное отклонение времени.

Параметры конфигурации:

Имя датасета --- скрипт добавляет к нему путь и '.txt' и берёт данные из соответствующего файла
ranker --- ранжирующая модель (None, MB25 или CrossEncoder). Если указано None, ранжирование происходит с помощью векторной базы.
doc_num --- количество документов, которые выдаёт векторная база. Произвольное натуральное число
metric --- метрика для оценки качества (пока только inv_5). Оценивает качество списка абзацев по тому, на какой позиции встретился размеченный. inv_5 считается по формуле $\frac{5}{n + 5}$

Результаты тестирования:

Можно посмотреть в [файле](results/ттх%20поисковика.pdf) 


Нужно добавить:
1) Кэширование страницы. То есть, чтобы при повторном одинаковом запросе (как GET, так и POST) не проводился поиск, а выдавалась сохранённая страница
2) Оценка релевантности запроса (кворум), чтоб не выдавать мусор.
3) Суммаризацию доделать
4) И структурировать и кластеризовать выдачу (то есть если несколько блоков из одной страниы, то сначал показать страницу, а потом пункты)
5) Исследование по векторному индексу. Надо чтобы проверили разные конфигурации ANN и остановились на лучший (а не сразу на Flatt). Добавить latency, пропускная способность, throuput. И понять что можно улучшить.
6) По ранжированию подумать о би энкодере, а на BM25 можно подумать что потюнить (коэффы, proximity, нормализация, стэмминг).



Разобраться с параметрами, объяснить их.
Можно сдеалать кросс энкодер после bm25.

Селать распределение времени ответов всей системы.
Подробнее расписать throwput.


Замечания по RAG поиску по текстам википедии:

1) Рассказать в деталях про архитектуру моделей. Как про разработанные компоненты, так и интегрированные извне
2) Не делать эмбеддинги для би-энкодера, кросс-енкодера в рантайме, а использовать вектора подготовленные в офлайне.
3) Подумать о лучшем решении для кворума.
4) Сделать отчёт по сравнению моделей-суммаризаторов.
5) Попробовать одновременно с векторным поиском использовать и текстовый поиск.
6) Сделать подробную презентацию с объединением всех компонентов. Плюс демо

Вопросы:
1) Хоккейный клуб СКА
2) Дата рождения Александра Сергеевича Пушкина
3) Великий русский поэт
4) Кто такие белые хакеры
